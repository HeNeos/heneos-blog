<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="https://projecteuler.net/profile/HeNeos.png"/><link rel="stylesheet" href="/heneos-blog/_next/static/css/10c5481d6c776747.css" data-precedence="next"/><link rel="stylesheet" href="/heneos-blog/_next/static/css/894b41753079a4a0.css" data-precedence="next"/><link rel="stylesheet" href="/heneos-blog/_next/static/css/5eacd01f773eed7f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/heneos-blog/_next/static/chunks/webpack-f5e2af5b5e96ca99.js"/><script src="/heneos-blog/_next/static/chunks/4bd1b696-2bfa57da125389e3.js" async=""></script><script src="/heneos-blog/_next/static/chunks/587-b330864006e0cdca.js" async=""></script><script src="/heneos-blog/_next/static/chunks/main-app-c254e3910443191a.js" async=""></script><script src="/heneos-blog/_next/static/chunks/app/blog/%5Bslug%5D/page-4374ee6693381f28.js" async=""></script><title>AWS Ascii Art | HeNeos blog</title><meta name="description" content="Deploying an ascii art application in AWS"/><script src="/heneos-blog/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="bg-zinc-950 text-zinc-100 min-h-screen"><header class="p-6 border-b border-zinc-800"><div class="max-w-6xl mx-auto"><div class="mb-10"><h1 class="text-4xl font-bold tracking-tighter mb-4 text-center">HeNeos blog</h1><p class="text-center text-zinc-500 mb-2">Josue H. @ JP Morgan Chase</p><p class="text-center text-zinc-600">HeNeos</p></div><div class="flex justify-center space-x-20 mb-4"><a target="_blank" class="text-zinc-500 hover:text-accent animated-underline" href="https://github.com/HeNeos">GitHub</a><a target="_blank" class="text-zinc-500 hover:text-accent animated-underline" href="https://www.linkedin.com/in/heneos">LinkedIn</a><a class="text-zinc-500 hover:text-accent animated-underline" href="mailto:he.neos@outlook.com">Email</a></div><div class="flex flex-col sm:flex-row justify-center gap-4 border-t border-zinc-800 pt-4"><a href="/heneos-blog"><div class="cursor-pointer hover:bg-gray-200 hover:text-zinc-900 transition-colors px-4 py-2 rounded-md flex items-center justify-between"><span>Home</span><span class="text-zinc-500 ml-6">ha</span></div></a><a href="/heneos-blog/blog"><div class="cursor-pointer hover:bg-gray-200 hover:text-zinc-900 transition-colors px-4 py-2 rounded-md flex items-center justify-between"><span>Blog</span><span class="text-zinc-500 ml-6">hb</span></div></a><a href="/heneos-blog/about"><div class="cursor-pointer hover:bg-gray-200 hover:text-zinc-900 transition-colors px-4 py-2 rounded-md flex items-center justify-between"><span>About</span><span class="text-zinc-500 ml-6">hc</span></div></a></div></div></header><main class="container mx-auto px-4 py-8 max-w-5xl"><div class="max-w-5xl mx-auto"><a class="text-zinc-500 hover:text-blue-400 mb-6 inline-block animated-underline" href="/heneos-blog/blog">‚Üê Back to all posts</a><article class="border border-zinc-800 rounded-lg p-4 bg-zinc-900/30"><header class="mb-8 border-b border-zinc-800 pb-6"><h1 class="text-3xl font-bold mb-4 gradient-text">AWS Ascii Art</h1><p class="text-zinc-500 mb-4 font-mono">April 19, 2025</p><div class="flex gap-2 flex-wrap"><span class="inline-block bg-zinc-800 text-zinc-300 px-2 py-1 text-xs rounded-sm">#<!-- -->cloud</span><span class="inline-block bg-zinc-800 text-zinc-300 px-2 py-1 text-xs rounded-sm">#<!-- -->image-processing</span></div></header><div class="gap-4 mt-8"><div class="prose prose-invert prose-zinc max-w-none"><p class="text-sm text-zinc-300 my-4 leading-relaxed">It&#x27;s been a long time since my last blog entry. I made a lot of progress on this and I finally feel satisfied with my architecture.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">In the last entry I explained how to implement an <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">ascii art</code> application, however that is the local version, this one is about how to design the same idea but to deploy it in cloud environments.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">You can think that&#x27;s pretty straightforward if you already have the code, you can just deploy a EC2 or using ECS/EKS with an image of the code, and <em>yes</em>, you&#x27;re right... that&#x27;s probably the easiest way to do, however, I can&#x27;t confirm if that&#x27;s the most <strong>optimal</strong>.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Why?</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Because in AWS you have many options to host your application, every service has a different limit/quota and price.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">First question we have to answer is, what&#x27;s our goal for our cloud application? I&#x27;m talking about the <em>-ilities</em> of the architecture, not about the application code.</p>
<ol class="text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2">
<li class="text-zinc-300">Optimal cost (near to 0).</li>
<li class="text-zinc-300">Reasonably scalable.</li>
<li class="text-zinc-300">High elasticity.</li>
</ol>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Those are my goals for this cloud application, however I want to add an additional one, it&#x27;s up to you if you consider it an <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">-ility</code>.</p>
<ol class="text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2">
<li class="text-zinc-300">Mostly serverless</li>
</ol>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">To accomplish the number 2 and 3, you can think to use EC2 and something like an <strong>autoscaling group</strong>, it could be based on <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">CPU</code> or <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">number of requests</code>.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Same approach could be used with EKS if you want to follow a Kubernetes approach.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">However, none of them are serverless solutions and we have to keep an instace running 24/7, does it make sense?</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">You can feel tempted to use something like EC2 Spot Instances to reduce costs and then save money since this is not a critical application and it&#x27;s ok if it takes longer to process the ascii art. However it&#x27;s still not serverless.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Okay, then let&#x27;s try with ECS Fargate. It&#x27;s <em>serverless</em>, it means the container are scheduled when it&#x27;s needed, when there&#x27;s no requests we should have 0 instances running.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">It&#x27;s a better solution and we don&#x27;t have to deal so much with the autoscaling and our application will be able to handle thousands of requests... but it fails in the number 3: <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">High elasticity</code>. Why??? Well, because unless you&#x27;re optimizing the image for the application, it&#x27;s gonna take a while to provide a container, I think it&#x27;s not so high, but still it&#x27;ll fail in the elasticity and it will add some delay to users.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">So, it looks it&#x27;s done for us, there&#x27;s no a complete serverless service that can handle our ascii art application with our requirements, right?</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Nope, I left the most foundational computing serverless service: <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">AWS Lambda</code>.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">You could be concerned about some perks about using Lambda for this, but that&#x27;s my goal here. I&#x27;m aiming to built a complete serverless computing service, keeping it scalable and with short processing times.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">First, let&#x27;s see how a solution using Lambda solves the <em>-ilities</em> we stated before.</p>
<ol class="text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2">
<li class="text-zinc-300">Optimal cost: AWS Lambda provides us a generous free-tier.</li>
<li class="text-zinc-300">Reasonably scalable: AWS Lambda has a concurrency limit of 1000.</li>
<li class="text-zinc-300">High elasticity: AWS Lambda automatically scale-down and up based on demand, no limits under the 1000 concurrency limit.</li>
<li class="text-zinc-300">Mostly serverless: AWS Lambda is a completely service.</li>
</ol>
<h2 class="text-xl font-bold mt-8 mb-4 text-zinc-100 border-b border-zinc-800 pb-2">Schematizing cloud solution: Lambda functions</h2>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">I&#x27;m going to start only for the image processing, because for the video... oh the video, it&#x27;s way harder.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">We can conceptualize the ascii art processing in two steps:</p>
<ol class="text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2">
<li class="text-zinc-300">Resize the image.</li>
<li class="text-zinc-300">Make the ascii art from resized image.</li>
</ol>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">It looks fair simple, you can be tempted to do both steps in a single lambda, but hear is the trick. What about if I reword the steps to:</p>
<ol class="text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2">
<li class="text-zinc-300">Resize the media.</li>
<li class="text-zinc-300">Process frames.</li>
</ol>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Now it looks more like video, right? Actually both image and video are similar, and could be conceptualized as the same, the only issue is that video is computational more expensive, but we&#x27;ll address that issue later.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">It means, if we want to extend our architecture to video, it&#x27;s better if we separate the steps in different lambdas. It also has another benefit that&#x27;s we are gonna have less requirements for each lambda and then the image will be lighter, making that the lambda can initialize faster and we have a more specific way to provide memory and timeout limits for the lambdas.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">We&#x27;re gonna need some storage solution to save the resized image and the processed ascii art, since we want to keep this serverless and cost efficient the solution is obvious: <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">S3</code>.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Additionally, we need some orchestration tool so that our lambdas know what is the next step, another serverless solution: <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">Step functions</code>.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Until now, our architecture consists of an image stored in <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">S3</code>, then the <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">Step function</code> consists of two lambdas, the first one is gonna resize the image and save it in <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">S3</code>, then the process image lambda is gonna read the resized image and generate the ascii art, then save it in <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">S3</code>.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Let&#x27;s start with the resize image lambda:</p>
<pre class="rounded-sm p-4 overflow-auto bg-zinc-900 text-zinc-100 my-4 border border-zinc-800"><code class="hljs language-py text-xs">MAX_HEIGHT: <span class="hljs-built_in">int</span> = <span class="hljs-built_in">int</span>(os.environ[<span class="hljs-string">&quot;MAX_HEIGHT&quot;</span>])

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LambdaEvent</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    key: <span class="hljs-built_in">str</span>
    bucket_name: <span class="hljs-built_in">str</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">rescale_image</span>(<span class="hljs-params">image: Image.Image, height_to_resize: <span class="hljs-built_in">int</span></span>) -&gt; Image.Image:
    width, height = image.size

    resized_height: <span class="hljs-built_in">int</span> = height_to_resize // Font.Height.value
    resized_width: <span class="hljs-built_in">int</span> = <span class="hljs-built_in">int</span>(
        resized_height * width * Font.Height.value / (Font.Width.value * height)
    )

    resized_image = image.resize((resized_width, resized_height))
    <span class="hljs-keyword">return</span> resized_image

<span class="hljs-keyword">def</span> <span class="hljs-title function_">lambda_handler</span>(<span class="hljs-params">event: LambdaEvent, _: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    file_path: <span class="hljs-built_in">str</span> = event[<span class="hljs-string">&quot;key&quot;</span>]
    bucket_name: <span class="hljs-built_in">str</span> = event[<span class="hljs-string">&quot;bucket_name&quot;</span>]

    image_file: ImageFile = cast(ImageFile, find_media_type(file_path))

    resolution: <span class="hljs-built_in">int</span> = <span class="hljs-built_in">min</span>(<span class="hljs-built_in">int</span>(response[<span class="hljs-string">&quot;resolution&quot;</span>][<span class="hljs-string">&quot;S&quot;</span>]), MAX_HEIGHT)

    local_file: <span class="hljs-built_in">str</span> = download_from_s3(s3_client, bucket_name, file_path)
    image: Image.Image = Image.<span class="hljs-built_in">open</span>(local_file).convert(<span class="hljs-string">&quot;RGB&quot;</span>)

    resized_image = rescale_image(image, resolution)
    resized_image_name = <span class="hljs-string">f&quot;<span class="hljs-subst">{image_file.random_id}</span>/<span class="hljs-subst">{image_file.file_name}</span>_resized.<span class="hljs-subst">{image_file.extension.value}</span>&quot;</span>

    image_object: ImagePillow = ImagePillow(resized_image, image_file.extension)
    image_object.write_to_buffer()

    processed_key: <span class="hljs-built_in">str</span> = image_object.save_image(
        s3_client,
        bucket_name,
        <span class="hljs-string">f&quot;processed/<span class="hljs-subst">{resized_image_name}</span>&quot;</span>,
    )
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">&quot;key&quot;</span>: file_path,
        <span class="hljs-string">&quot;is_video&quot;</span>: <span class="hljs-literal">False</span>,
        <span class="hljs-string">&quot;is_image&quot;</span>: <span class="hljs-literal">True</span>,
        <span class="hljs-string">&quot;bucket_name&quot;</span>: bucket_name,
        <span class="hljs-string">&quot;processed_key&quot;</span>: processed_key,
        <span class="hljs-string">&quot;resolution&quot;</span>: resolution,
    }

</code></pre>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">pretty simple.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">Next lambda is a bit more complicated but we already have our ascii code from local, so we should only modularized it correctly.</p>
<pre class="rounded-sm p-4 overflow-auto bg-zinc-900 text-zinc-100 my-4 border border-zinc-800"><code class="hljs language-py text-xs"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LambdaEvent</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    key: <span class="hljs-built_in">str</span>
    processed_key: <span class="hljs-built_in">str</span>
    is_video: <span class="hljs-built_in">bool</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">lambda_handler</span>(<span class="hljs-params">event: LambdaEvent, _: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span> | <span class="hljs-built_in">str</span>]:
    initial_key: <span class="hljs-built_in">str</span> = event[<span class="hljs-string">&quot;key&quot;</span>]
    _, _, random_id = split_file_name(initial_key)
    file_path: <span class="hljs-built_in">str</span> = event[<span class="hljs-string">&quot;processed_key&quot;</span>]

    media_file: MediaFile = find_media_type(file_path)
    local_file: <span class="hljs-built_in">str</span> = download_from_s3(s3_client, MEDIA_BUCKET, file_path)

    image: Image.Image = Image.<span class="hljs-built_in">open</span>(local_file).convert(<span class="hljs-string">&quot;RGB&quot;</span>)
    width, height = image.size
    ascii_dict = get_ascii_dict(width, height, output)

    char_array = create_char_array(ascii_dict)
    ascii_image = ascii_convert(image, char_array)
    image_object: ImageCairo = ImageCairo(
        ascii_image, ImageExtension(media_file.extension)
    )
    image_object.write_to_buffer()
    key = image_object.save_image(
        s3_client,
        ASCII_ART_BUCKET,
        <span class="hljs-string">f&quot;<span class="hljs-subst">{random_id}</span>/<span class="hljs-subst">{media_file.file_name}</span>_ascii.<span class="hljs-subst">{media_file.extension.value}</span>&quot;</span>,
    )
    url: <span class="hljs-built_in">str</span> = s3_client.generate_presigned_url(
        <span class="hljs-string">&quot;get_object&quot;</span>,
        Params={
            <span class="hljs-string">&quot;Bucket&quot;</span>: ASCII_ART_BUCKET,
            <span class="hljs-string">&quot;Key&quot;</span>: key,
        },
        ExpiresIn=<span class="hljs-number">300</span>,
    )
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">&quot;statusCode&quot;</span>: <span class="hljs-number">200</span>,
        <span class="hljs-string">&quot;ascii_art_key&quot;</span>: key,
        <span class="hljs-string">&quot;body&quot;</span>: dumps(cast(<span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>], {<span class="hljs-string">&quot;url&quot;</span>: url})),
    }
</code></pre>
<h2 class="text-xl font-bold mt-8 mb-4 text-zinc-100 border-b border-zinc-800 pb-2">Storing the art: S3</h2>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">So far, we have our lambda functions and now we need a way to store images <del>in the future it&#x27;ll be used for videos too</del>.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">There is actually not so much mistery here, it&#x27;s just creating the buckets and that&#x27;s it... well, just a bit more.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">It&#x27;s faster to explain it with the code, and for this project I&#x27;m gonna use <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">terraform</code>, it&#x27;s not my favorite choice but, just give it a try for now.</p>
<pre class="rounded-sm p-4 overflow-auto bg-zinc-900 text-zinc-100 my-4 border border-zinc-800"><code class="hljs language-tf text-xs">locals {
  buckets = {
    media = {
      name_prefix     = &quot;media-bucket&quot;
      expiration_days = 1
    },
    audio = {
      name_prefix     = &quot;audio-bucket&quot;
      expiration_days = 1
    },
    ascii_art = {
      name_prefix     = &quot;ascii-art-bucket&quot;
      expiration_days = 1
    }
  }
}

resource &quot;aws_s3_bucket&quot; &quot;bucket&quot; {
  for_each = local.buckets
  bucket = &quot;${each.value.name_prefix}-${var.stage}-${var.account_id}&quot;
  lifecycle {
    prevent_destroy = true
  }
}

resource &quot;aws_s3_bucket_versioning&quot; &quot;versioning&quot; {
  for_each = local.buckets
  bucket = aws_s3_bucket.bucket[each.key].id
  versioning_configuration {
    status = &quot;Enabled&quot;
  }
}

resource &quot;aws_s3_bucket_lifecycle_configuration&quot; &quot;buckets_config&quot; {
  for_each = local.buckets
  bucket = aws_s3_bucket.bucket[each.key].id
  rule {
    id = &quot;Delete old files&quot;
    expiration {
      days = each.value.expiration_days
    }
    expiration {
      expired_object_delete_marker = true
    }
    noncurrent_version_expiration {
      noncurrent_days = each.value.expiration_days
    }
    status = &quot;Enabled&quot;
  }
}
</code></pre>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">the only configuration for the buckets is enabling the versioning and adding a lifecycle configuration to delete the files after 1 day.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">That way we&#x27;re not going to spend so much money storing old assets and we could keep under the 5GiB that are in the S3 free tier.</p>
<h2 class="text-xl font-bold mt-8 mb-4 text-zinc-100 border-b border-zinc-800 pb-2">Orchestrating: Step functions</h2>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">We require some way to indicate our lambda functions how they should <em>flow</em>, this process is called <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">orchestration</code> and I&#x27;m gonna use <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">step functions</code> to accomplish this.</p>
<p class="text-sm text-zinc-300 my-4 leading-relaxed">This is a <code class="bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs">long long</code> definition, so I&#x27;ll trim it and keep the only part needed for the image, please also keep in mind this is just a <em>draft</em> and not the actual code. Also, you have to figure out by your own the required IAM permissions to make it work.</p>
<pre class="rounded-sm p-4 overflow-auto bg-zinc-900 text-zinc-100 my-4 border border-zinc-800"><code class="hljs language-tf text-xs">resource &quot;aws_sfn_state_machine&quot; &quot;step_function&quot; {
  name     = &quot;AsciiArt-${var.stage}&quot;
  role_arn = aws_iam_role.step_function_role.arn

  definition = &lt;&lt;-DEFINITION
  {
    &quot;Comment&quot;: &quot;AsciiArt State Machine&quot;,
    &quot;StartAt&quot;: &quot;ExtractFileExtension&quot;,
    &quot;States&quot;: {
      &quot;ExtractFileExtension&quot;: {
        &quot;Type&quot;: &quot;Pass&quot;,
        &quot;ResultPath&quot;: &quot;$.fileExtension&quot;,
        &quot;Parameters&quot;: {
          &quot;key.$&quot;: &quot;$.detail.object.key&quot;,
          &quot;bucket_name.$&quot;: &quot;$.detail.bucket.name&quot;,
          &quot;extension.$&quot;: &quot;States.ArrayGetItem(States.StringSplit($.detail.object.key, &#x27;.&#x27;), States.MathAdd(States.ArrayLength(States.StringSplit($.detail.object.key, &#x27;.&#x27;)), -1))&quot;
        },
        &quot;Next&quot;: &quot;IsVideo&quot;
      },
      &quot;IsVideo&quot;: {
        &quot;Type&quot;: &quot;Choice&quot;,
        &quot;Choices&quot;: [
          {
            &quot;Variable&quot;: &quot;$.is_video&quot;,
            &quot;BooleanEquals&quot;: true,
            &quot;Next&quot;: &quot;DownsizeVideo&quot;
          },
          {
            &quot;Variable&quot;: &quot;$.is_image&quot;,
            &quot;BooleanEquals&quot;: true,
            &quot;Next&quot;: &quot;DownsizeMedia&quot;
          }
        ],
        &quot;Default&quot;: &quot;NotSupported&quot;
      },
      &quot;DownsizeMedia&quot;: {
        &quot;Type&quot;: &quot;Task&quot;,
        &quot;Resource&quot;: &quot;${aws_lambda_function.downsize_media.arn}&quot;,
        &quot;Next&quot;: &quot;ProcessImage&quot;
      },
      &quot;ProcessImage&quot;: {
        &quot;Type&quot;: &quot;Task&quot;,
        &quot;Resource&quot;: &quot;${aws_lambda_function.process_image.arn}&quot;,
        &quot;End&quot;: true
      },
    }
  }
  DEFINITION
}
</code></pre></div></div></article></div></main><footer class="border-t border-zinc-800 py-6 mt-12"><div class="container mx-auto px-4 relative h-full"><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div><h3 class="text-lg font-semibold text-white mb-4">Connect</h3><div class="flex space-x-4"><a href="https://github.com/HeNeos" target="_blank" rel="noopener noreferrer" class="text-slate-400 hover:text-white transition-colors">GitHub</a><a href="https://x.com/_HeNeos" target="_blank" rel="noopener noreferrer" class="text-slate-400 hover:text-white transition-colors">X</a><a href="https://codeforces.com/profile/HeNeos" target="_blank" rel="noopener noreferrer" class="text-slate-400 hover:text-white transition-colors">Codeforces</a><a href="https://codeforces.com/profile/Ptolemy_314" target="_blank" rel="noopener noreferrer" class="text-slate-400 hover:text-white transition-colors">Codeforces old</a></div></div><div><h4 class="text-lg font-semibold text-white mb-4">Project Euler</h4><a href="https://projecteuler.net/profile/HeNeos.png" target="_blank" rel="noopener noreferrer"><img src="https://projecteuler.net/profile/HeNeos.png" alt="Project Euler Profile" class=" h-auto max-h-10 rounded-sm object-contain"/></a></div></div></div></footer><script src="/heneos-blog/_next/static/chunks/webpack-f5e2af5b5e96ca99.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8173,[\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-4374ee6693381f28.js\"],\"\"]\n3:I[5244,[],\"\"]\n4:I[3866,[],\"\"]\n7:I[6213,[],\"OutletBoundary\"]\na:I[6213,[],\"ViewportBoundary\"]\nc:I[6213,[],\"MetadataBoundary\"]\ne:I[4835,[],\"\"]\n:HL[\"/heneos-blog/_next/static/css/10c5481d6c776747.css\",\"style\"]\n:HL[\"/heneos-blog/_next/static/css/894b41753079a4a0.css\",\"style\"]\n:HL[\"/heneos-blog/_next/static/css/5eacd01f773eed7f.css\",\"style\"]\n5:T43d,locals {\n  buckets = {\n    media = {\n      name_prefix     = \"media-bucket\"\n      expiration_days = 1\n    },\n    audio = {\n      name_prefix     = \"audio-bucket\"\n      expiration_days = 1\n    },\n    ascii_art = {\n      name_prefix     = \"ascii-art-bucket\"\n      expiration_days = 1\n    }\n  }\n}\n\nresource \"aws_s3_bucket\" \"bucket\" {\n  for_each = local.buckets\n  bucket = \"${each.value.name_prefix}-${var.stage}-${var.account_id}\"\n  lifecycle {\n    prevent_destroy = true\n  }\n}\n\nresource \"aws_s3_bucket_versioning\" \"versioning\" {\n  for_each = local.buckets\n  bucket = aws_s3_bucket.bucket[each.key].id\n  versioning_configuration {\n    status = \"Enabled\"\n  }\n}\n\nresource \"aws_s3_bucket_lifecycle_configuration\" \"buckets_config\" {\n  for_each = local.buckets\n  bucket = aws_s3_bucket.bucket[each.key].id\n  rule {\n    id = \"Delete old files\"\n    expiration {\n      days = each.value.expiration_days\n    }\n    expiration {\n      expired_object_delete_marker = true\n    }\n    noncurrent_version_expiration {\n      noncurrent_days = each.value.expiration_days\n    }\n    status = \"Enabled\"\n  }\n}\n6:T585,resource \"aws_sfn_state_machine\" \"step_function\" {\n  name     = \"AsciiArt-${var.stage}\"\n  role_arn = aws_iam_role.step_function_role.arn\n\n  definition = \u003c\u003c-DEFINITION\n  {\n    \"Comment\": \"AsciiArt State Machine\",\n    \"StartAt\": \"ExtractFileExtension\",\n    \"States\": {\n      \"ExtractFileExtension\": {\n        \"Type\": \"Pass\",\n        \"ResultPath\": \"$.fileExtension\",\n        \"Parameters\": {\n          \"key.$\": \"$.detail.object.key\",\n          \"bucket_name.$\": \"$.detail.bucket.name\",\n          \"extension.$\": "])</script><script>self.__next_f.push([1,"\"States.ArrayGetItem(States.StringSplit($.detail.object.key, '.'), States.MathAdd(States.ArrayLength(States.StringSplit($.detail.object.key, '.')), -1))\"\n        },\n        \"Next\": \"IsVideo\"\n      },\n      \"IsVideo\": {\n        \"Type\": \"Choice\",\n        \"Choices\": [\n          {\n            \"Variable\": \"$.is_video\",\n            \"BooleanEquals\": true,\n            \"Next\": \"DownsizeVideo\"\n          },\n          {\n            \"Variable\": \"$.is_image\",\n            \"BooleanEquals\": true,\n            \"Next\": \"DownsizeMedia\"\n          }\n        ],\n        \"Default\": \"NotSupported\"\n      },\n      \"DownsizeMedia\": {\n        \"Type\": \"Task\",\n        \"Resource\": \"${aws_lambda_function.downsize_media.arn}\",\n        \"Next\": \"ProcessImage\"\n      },\n      \"ProcessImage\": {\n        \"Type\": \"Task\",\n        \"Resource\": \"${aws_lambda_function.process_image.arn}\",\n        \"End\": true\n      },\n    }\n  }\n  DEFINITION\n}\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"9ssVT_-p4Tu2l49Cg4Cd3\",\"p\":\"/heneos-blog\",\"c\":[\"\",\"blog\",\"2025-04-19-cloud-ascii-art-aws\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"2025-04-19-cloud-ascii-art-aws\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/heneos-blog/_next/static/css/10c5481d6c776747.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/heneos-blog/_next/static/css/894b41753079a4a0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"bg-zinc-950 text-zinc-100 min-h-screen\",\"children\":[[\"$\",\"header\",null,{\"className\":\"p-6 border-b border-zinc-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-6xl mx-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mb-10\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold tracking-tighter mb-4 text-center\",\"children\":\"HeNeos blog\"}],[\"$\",\"p\",null,{\"className\":\"text-center text-zinc-500 mb-2\",\"children\":\"Josue H. @ JP Morgan Chase\"}],[\"$\",\"p\",null,{\"className\":\"text-center text-zinc-600\",\"children\":\"HeNeos\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex justify-center space-x-20 mb-4\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"https://github.com/HeNeos\",\"target\":\"_blank\",\"className\":\"text-zinc-500 hover:text-accent animated-underline\",\"children\":\"GitHub\"}],[\"$\",\"$L2\",null,{\"href\":\"https://www.linkedin.com/in/heneos\",\"target\":\"_blank\",\"className\":\"text-zinc-500 hover:text-accent animated-underline\",\"children\":\"LinkedIn\"}],[\"$\",\"$L2\",null,{\"href\":\"mailto:he.neos@outlook.com\",\"className\":\"text-zinc-500 hover:text-accent animated-underline\",\"children\":\"Email\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col sm:flex-row justify-center gap-4 border-t border-zinc-800 pt-4\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/\",\"children\":[\"$\",\"div\",null,{\"className\":\"cursor-pointer hover:bg-gray-200 hover:text-zinc-900 transition-colors px-4 py-2 rounded-md flex items-center justify-between\",\"children\":[[\"$\",\"span\",null,{\"children\":\"Home\"}],[\"$\",\"span\",null,{\"className\":\"text-zinc-500 ml-6\",\"children\":\"ha\"}]]}]}],[\"$\",\"$L2\",null,{\"href\":\"/blog\",\"children\":[\"$\",\"div\",null,{\"className\":\"cursor-pointer hover:bg-gray-200 hover:text-zinc-900 transition-colors px-4 py-2 rounded-md flex items-center justify-between\",\"children\":[[\"$\",\"span\",null,{\"children\":\"Blog\"}],[\"$\",\"span\",null,{\"className\":\"text-zinc-500 ml-6\",\"children\":\"hb\"}]]}]}],[\"$\",\"$L2\",null,{\"href\":\"/about\",\"children\":[\"$\",\"div\",null,{\"className\":\"cursor-pointer hover:bg-gray-200 hover:text-zinc-900 transition-colors px-4 py-2 rounded-md flex items-center justify-between\",\"children\":[[\"$\",\"span\",null,{\"children\":\"About\"}],[\"$\",\"span\",null,{\"className\":\"text-zinc-500 ml-6\",\"children\":\"hc\"}]]}]}]]}]]}]}],[\"$\",\"main\",null,{\"className\":\"container mx-auto px-4 py-8 max-w-5xl\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"$undefined\",[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"border-t border-zinc-800 py-6 mt-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"container mx-auto px-4 relative h-full\",\"children\":[\"$\",\"div\",null,{\"className\":\"grid grid-cols-1 md:grid-cols-2 gap-8\",\"children\":[[\"$\",\"div\",null,{\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-lg font-semibold text-white mb-4\",\"children\":\"Connect\"}],[\"$\",\"div\",null,{\"className\":\"flex space-x-4\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/HeNeos\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-slate-400 hover:text-white transition-colors\",\"children\":\"GitHub\"}],[\"$\",\"a\",null,{\"href\":\"https://x.com/_HeNeos\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-slate-400 hover:text-white transition-colors\",\"children\":\"X\"}],[\"$\",\"a\",null,{\"href\":\"https://codeforces.com/profile/HeNeos\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-slate-400 hover:text-white transition-colors\",\"children\":\"Codeforces\"}],[\"$\",\"a\",null,{\"href\":\"https://codeforces.com/profile/Ptolemy_314\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-slate-400 hover:text-white transition-colors\",\"children\":\"Codeforces old\"}]]}]]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"h4\",null,{\"className\":\"text-lg font-semibold text-white mb-4\",\"children\":\"Project Euler\"}],[\"$\",\"a\",null,{\"href\":\"https://projecteuler.net/profile/HeNeos.png\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":[\"$\",\"img\",null,{\"src\":\"https://projecteuler.net/profile/HeNeos.png\",\"alt\":\"Project Euler Profile\",\"className\":\" h-auto max-h-10 rounded-sm object-contain\"}]}]]}]]}]}]}]]}]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"2025-04-19-cloud-ascii-art-aws\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"className\":\"max-w-5xl mx-auto\",\"children\":[[\"$\",\"$L2\",null,{\"href\":\"/blog\",\"className\":\"text-zinc-500 hover:text-blue-400 mb-6 inline-block animated-underline\",\"children\":\"‚Üê Back to all posts\"}],[\"$\",\"article\",null,{\"className\":\"border border-zinc-800 rounded-lg p-4 bg-zinc-900/30\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8 border-b border-zinc-800 pb-6\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl font-bold mb-4 gradient-text\",\"children\":\"AWS Ascii Art\"}],[\"$\",\"p\",null,{\"className\":\"text-zinc-500 mb-4 font-mono\",\"children\":\"April 19, 2025\"}],[\"$\",\"div\",null,{\"className\":\"flex gap-2 flex-wrap\",\"children\":[[\"$\",\"span\",\"cloud\",{\"className\":\"inline-block bg-zinc-800 text-zinc-300 px-2 py-1 text-xs rounded-sm\",\"children\":[\"#\",\"cloud\"]}],[\"$\",\"span\",\"image-processing\",{\"className\":\"inline-block bg-zinc-800 text-zinc-300 px-2 py-1 text-xs rounded-sm\",\"children\":[\"#\",\"image-processing\"]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"gap-4 mt-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"prose prose-invert prose-zinc max-w-none\",\"children\":[[\"$\",\"p\",\"p-0\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"It's been a long time since my last blog entry. I made a lot of progress on this and I finally feel satisfied with my architecture.\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"In the last entry I explained how to implement an \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"ascii art\"}],\" application, however that is the local version, this one is about how to design the same idea but to deploy it in cloud environments.\"]}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"You can think that's pretty straightforward if you already have the code, you can just deploy a EC2 or using ECS/EKS with an image of the code, and \",[\"$\",\"em\",\"em-0\",{\"children\":\"yes\"}],\", you're right... that's probably the easiest way to do, however, I can't confirm if that's the most \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"optimal\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"Why?\"}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"Because in AWS you have many options to host your application, every service has a different limit/quota and price.\"}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"First question we have to answer is, what's our goal for our cloud application? I'm talking about the \",[\"$\",\"em\",\"em-0\",{\"children\":\"-ilities\"}],\" of the architecture, not about the application code.\"]}],\"\\n\",[\"$\",\"ol\",\"ol-0\",{\"className\":\"text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2\",\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"className\":\"text-zinc-300\",\"children\":\"Optimal cost (near to 0).\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"className\":\"text-zinc-300\",\"children\":\"Reasonably scalable.\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"className\":\"text-zinc-300\",\"children\":\"High elasticity.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"Those are my goals for this cloud application, however I want to add an additional one, it's up to you if you consider it an \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"-ility\"}],\".\"]}],\"\\n\",[\"$\",\"ol\",\"ol-1\",{\"className\":\"text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2\",\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"className\":\"text-zinc-300\",\"children\":\"Mostly serverless\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"To accomplish the number 2 and 3, you can think to use EC2 and something like an \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"autoscaling group\"}],\", it could be based on \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"CPU\"}],\" or \",[\"$\",\"code\",\"code-1\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"number of requests\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"Same approach could be used with EKS if you want to follow a Kubernetes approach.\"}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"However, none of them are serverless solutions and we have to keep an instace running 24/7, does it make sense?\"}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"You can feel tempted to use something like EC2 Spot Instances to reduce costs and then save money since this is not a critical application and it's ok if it takes longer to process the ascii art. However it's still not serverless.\"}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"Okay, then let's try with ECS Fargate. It's \",[\"$\",\"em\",\"em-0\",{\"children\":\"serverless\"}],\", it means the container are scheduled when it's needed, when there's no requests we should have 0 instances running.\"]}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"It's a better solution and we don't have to deal so much with the autoscaling and our application will be able to handle thousands of requests... but it fails in the number 3: \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"High elasticity\"}],\". Why??? Well, because unless you're optimizing the image for the application, it's gonna take a while to provide a container, I think it's not so high, but still it'll fail in the elasticity and it will add some delay to users.\"]}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"So, it looks it's done for us, there's no a complete serverless service that can handle our ascii art application with our requirements, right?\"}],\"\\n\",[\"$\",\"p\",\"p-14\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"Nope, I left the most foundational computing serverless service: \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"AWS Lambda\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-15\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"You could be concerned about some perks about using Lambda for this, but that's my goal here. I'm aiming to built a complete serverless computing service, keeping it scalable and with short processing times.\"}],\"\\n\",[\"$\",\"p\",\"p-16\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"First, let's see how a solution using Lambda solves the \",[\"$\",\"em\",\"em-0\",{\"children\":\"-ilities\"}],\" we stated before.\"]}],\"\\n\",[\"$\",\"ol\",\"ol-2\",{\"className\":\"text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2\",\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"className\":\"text-zinc-300\",\"children\":\"Optimal cost: AWS Lambda provides us a generous free-tier.\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"className\":\"text-zinc-300\",\"children\":\"Reasonably scalable: AWS Lambda has a concurrency limit of 1000.\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"className\":\"text-zinc-300\",\"children\":\"High elasticity: AWS Lambda automatically scale-down and up based on demand, no limits under the 1000 concurrency limit.\"}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"className\":\"text-zinc-300\",\"children\":\"Mostly serverless: AWS Lambda is a completely service.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",\"h2-0\",{\"className\":\"text-xl font-bold mt-8 mb-4 text-zinc-100 border-b border-zinc-800 pb-2\",\"children\":\"Schematizing cloud solution: Lambda functions\"}],\"\\n\",[\"$\",\"p\",\"p-17\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"I'm going to start only for the image processing, because for the video... oh the video, it's way harder.\"}],\"\\n\",[\"$\",\"p\",\"p-18\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"We can conceptualize the ascii art processing in two steps:\"}],\"\\n\",[\"$\",\"ol\",\"ol-3\",{\"className\":\"text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2\",\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"className\":\"text-zinc-300\",\"children\":\"Resize the image.\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"className\":\"text-zinc-300\",\"children\":\"Make the ascii art from resized image.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-19\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"It looks fair simple, you can be tempted to do both steps in a single lambda, but hear is the trick. What about if I reword the steps to:\"}],\"\\n\",[\"$\",\"ol\",\"ol-4\",{\"className\":\"text-xs list-decimal pl-6 my-4 text-zinc-300 space-y-2\",\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"className\":\"text-zinc-300\",\"children\":\"Resize the media.\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"className\":\"text-zinc-300\",\"children\":\"Process frames.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-20\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"Now it looks more like video, right? Actually both image and video are similar, and could be conceptualized as the same, the only issue is that video is computational more expensive, but we'll address that issue later.\"}],\"\\n\",[\"$\",\"p\",\"p-21\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"It means, if we want to extend our architecture to video, it's better if we separate the steps in different lambdas. It also has another benefit that's we are gonna have less requirements for each lambda and then the image will be lighter, making that the lambda can initialize faster and we have a more specific way to provide memory and timeout limits for the lambdas.\"}],\"\\n\",[\"$\",\"p\",\"p-22\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"We're gonna need some storage solution to save the resized image and the processed ascii art, since we want to keep this serverless and cost efficient the solution is obvious: \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"S3\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-23\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"Additionally, we need some orchestration tool so that our lambdas know what is the next step, another serverless solution: \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"Step functions\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-24\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"Until now, our architecture consists of an image stored in \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"S3\"}],\", then the \",[\"$\",\"code\",\"code-1\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"Step function\"}],\" consists of two lambdas, the first one is gonna resize the image and save it in \",[\"$\",\"code\",\"code-2\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"S3\"}],\", then the process image lambda is gonna read the resized image and generate the ascii art, then save it in \",[\"$\",\"code\",\"code-3\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"S3\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-25\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"Let's start with the resize image lambda:\"}],\"\\n\",[\"$\",\"pre\",\"pre-0\",{\"className\":\"rounded-sm p-4 overflow-auto bg-zinc-900 text-zinc-100 my-4 border border-zinc-800\",\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-py text-xs\",\"children\":[\"MAX_HEIGHT: \",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}],\" = \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}],\"(os.environ[\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"\\\"MAX_HEIGHT\\\"\"}],\"])\\n\\n\",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-title class_\",\"children\":\"LambdaEvent\"}],\"(\",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-title class_ inherited__\",\"children\":\"TypedDict\"}],\"):\\n    key: \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\"\\n    bucket_name: \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\"\\n\\n\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title function_\",\"children\":\"rescale_image\"}],\"(\",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-params\",\"children\":[\"image: Image.Image, height_to_resize: \",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}]]}],\") -\u003e Image.Image:\\n    width, height = image.size\\n\\n    resized_height: \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}],\" = height_to_resize // Font.Height.value\\n    resized_width: \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}],\" = \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}],\"(\\n        resized_height * width * Font.Height.value / (Font.Width.value * height)\\n    )\\n\\n    resized_image = image.resize((resized_width, resized_height))\\n    \",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" resized_image\\n\\n\",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-title function_\",\"children\":\"lambda_handler\"}],\"(\",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-params\",\"children\":[\"event: LambdaEvent, _: \",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-built_in\",\"children\":\"dict\"}]]}],\") -\u003e \",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-built_in\",\"children\":\"dict\"}],\":\\n    file_path: \",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\" = event[\",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-string\",\"children\":\"\\\"key\\\"\"}],\"]\\n    bucket_name: \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\" = event[\",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-string\",\"children\":\"\\\"bucket_name\\\"\"}],\"]\\n\\n    image_file: ImageFile = cast(ImageFile, find_media_type(file_path))\\n\\n    resolution: \",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}],\" = \",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-built_in\",\"children\":\"min\"}],\"(\",[\"$\",\"span\",\"span-25\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}],\"(response[\",[\"$\",\"span\",\"span-26\",{\"className\":\"hljs-string\",\"children\":\"\\\"resolution\\\"\"}],\"][\",[\"$\",\"span\",\"span-27\",{\"className\":\"hljs-string\",\"children\":\"\\\"S\\\"\"}],\"]), MAX_HEIGHT)\\n\\n    local_file: \",[\"$\",\"span\",\"span-28\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\" = download_from_s3(s3_client, bucket_name, file_path)\\n    image: Image.Image = Image.\",[\"$\",\"span\",\"span-29\",{\"className\":\"hljs-built_in\",\"children\":\"open\"}],\"(local_file).convert(\",[\"$\",\"span\",\"span-30\",{\"className\":\"hljs-string\",\"children\":\"\\\"RGB\\\"\"}],\")\\n\\n    resized_image = rescale_image(image, resolution)\\n    resized_image_name = \",[\"$\",\"span\",\"span-31\",{\"className\":\"hljs-string\",\"children\":[\"f\\\"\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-subst\",\"children\":\"{image_file.random_id}\"}],\"/\",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-subst\",\"children\":\"{image_file.file_name}\"}],\"_resized.\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-subst\",\"children\":\"{image_file.extension.value}\"}],\"\\\"\"]}],\"\\n\\n    image_object: ImagePillow = ImagePillow(resized_image, image_file.extension)\\n    image_object.write_to_buffer()\\n\\n    processed_key: \",[\"$\",\"span\",\"span-32\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\" = image_object.save_image(\\n        s3_client,\\n        bucket_name,\\n        \",[\"$\",\"span\",\"span-33\",{\"className\":\"hljs-string\",\"children\":[\"f\\\"processed/\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-subst\",\"children\":\"{resized_image_name}\"}],\"\\\"\"]}],\",\\n    )\\n    \",[\"$\",\"span\",\"span-34\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" {\\n        \",[\"$\",\"span\",\"span-35\",{\"className\":\"hljs-string\",\"children\":\"\\\"key\\\"\"}],\": file_path,\\n        \",[\"$\",\"span\",\"span-36\",{\"className\":\"hljs-string\",\"children\":\"\\\"is_video\\\"\"}],\": \",[\"$\",\"span\",\"span-37\",{\"className\":\"hljs-literal\",\"children\":\"False\"}],\",\\n        \",[\"$\",\"span\",\"span-38\",{\"className\":\"hljs-string\",\"children\":\"\\\"is_image\\\"\"}],\": \",[\"$\",\"span\",\"span-39\",{\"className\":\"hljs-literal\",\"children\":\"True\"}],\",\\n        \",[\"$\",\"span\",\"span-40\",{\"className\":\"hljs-string\",\"children\":\"\\\"bucket_name\\\"\"}],\": bucket_name,\\n        \",[\"$\",\"span\",\"span-41\",{\"className\":\"hljs-string\",\"children\":\"\\\"processed_key\\\"\"}],\": processed_key,\\n        \",[\"$\",\"span\",\"span-42\",{\"className\":\"hljs-string\",\"children\":\"\\\"resolution\\\"\"}],\": resolution,\\n    }\\n\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-26\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"pretty simple.\"}],\"\\n\",[\"$\",\"p\",\"p-27\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"Next lambda is a bit more complicated but we already have our ascii code from local, so we should only modularized it correctly.\"}],\"\\n\",[\"$\",\"pre\",\"pre-1\",{\"className\":\"rounded-sm p-4 overflow-auto bg-zinc-900 text-zinc-100 my-4 border border-zinc-800\",\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-py text-xs\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-title class_\",\"children\":\"LambdaEvent\"}],\"(\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-title class_ inherited__\",\"children\":\"TypedDict\"}],\"):\\n    key: \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\"\\n    processed_key: \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\"\\n    is_video: \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-built_in\",\"children\":\"bool\"}],\"\\n\\n\\n\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"def\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-title function_\",\"children\":\"lambda_handler\"}],\"(\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-params\",\"children\":[\"event: LambdaEvent, _: \",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}]]}],\") -\u003e \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-built_in\",\"children\":\"dict\"}],\"[\",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\", \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-built_in\",\"children\":\"int\"}],\" | \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\"]:\\n    initial_key: \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\" = event[\",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-string\",\"children\":\"\\\"key\\\"\"}],\"]\\n    _, _, random_id = split_file_name(initial_key)\\n    file_path: \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\" = event[\",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-string\",\"children\":\"\\\"processed_key\\\"\"}],\"]\\n\\n    media_file: MediaFile = find_media_type(file_path)\\n    local_file: \",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\" = download_from_s3(s3_client, MEDIA_BUCKET, file_path)\\n\\n    image: Image.Image = Image.\",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-built_in\",\"children\":\"open\"}],\"(local_file).convert(\",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-string\",\"children\":\"\\\"RGB\\\"\"}],\")\\n    width, height = image.size\\n    ascii_dict = get_ascii_dict(width, height, output)\\n\\n    char_array = create_char_array(ascii_dict)\\n    ascii_image = ascii_convert(image, char_array)\\n    image_object: ImageCairo = ImageCairo(\\n        ascii_image, ImageExtension(media_file.extension)\\n    )\\n    image_object.write_to_buffer()\\n    key = image_object.save_image(\\n        s3_client,\\n        ASCII_ART_BUCKET,\\n        \",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-string\",\"children\":[\"f\\\"\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-subst\",\"children\":\"{random_id}\"}],\"/\",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-subst\",\"children\":\"{media_file.file_name}\"}],\"_ascii.\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-subst\",\"children\":\"{media_file.extension.value}\"}],\"\\\"\"]}],\",\\n    )\\n    url: \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\" = s3_client.generate_presigned_url(\\n        \",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-string\",\"children\":\"\\\"get_object\\\"\"}],\",\\n        Params={\\n            \",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-string\",\"children\":\"\\\"Bucket\\\"\"}],\": ASCII_ART_BUCKET,\\n            \",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-string\",\"children\":\"\\\"Key\\\"\"}],\": key,\\n        },\\n        ExpiresIn=\",[\"$\",\"span\",\"span-25\",{\"className\":\"hljs-number\",\"children\":\"300\"}],\",\\n    )\\n    \",[\"$\",\"span\",\"span-26\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" {\\n        \",[\"$\",\"span\",\"span-27\",{\"className\":\"hljs-string\",\"children\":\"\\\"statusCode\\\"\"}],\": \",[\"$\",\"span\",\"span-28\",{\"className\":\"hljs-number\",\"children\":\"200\"}],\",\\n        \",[\"$\",\"span\",\"span-29\",{\"className\":\"hljs-string\",\"children\":\"\\\"ascii_art_key\\\"\"}],\": key,\\n        \",[\"$\",\"span\",\"span-30\",{\"className\":\"hljs-string\",\"children\":\"\\\"body\\\"\"}],\": dumps(cast(\",[\"$\",\"span\",\"span-31\",{\"className\":\"hljs-built_in\",\"children\":\"dict\"}],\"[\",[\"$\",\"span\",\"span-32\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\", \",[\"$\",\"span\",\"span-33\",{\"className\":\"hljs-built_in\",\"children\":\"str\"}],\"], {\",[\"$\",\"span\",\"span-34\",{\"className\":\"hljs-string\",\"children\":\"\\\"url\\\"\"}],\": url})),\\n    }\\n\"]}]}],\"\\n\",[\"$\",\"h2\",\"h2-1\",{\"className\":\"text-xl font-bold mt-8 mb-4 text-zinc-100 border-b border-zinc-800 pb-2\",\"children\":\"Storing the art: S3\"}],\"\\n\",[\"$\",\"p\",\"p-28\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"So far, we have our lambda functions and now we need a way to store images \",[\"$\",\"del\",\"del-0\",{\"children\":\"in the future it'll be used for videos too\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-29\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"There is actually not so much mistery here, it's just creating the buckets and that's it... well, just a bit more.\"}],\"\\n\",[\"$\",\"p\",\"p-30\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"It's faster to explain it with the code, and for this project I'm gonna use \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"terraform\"}],\", it's not my favorite choice but, just give it a try for now.\"]}],\"\\n\",[\"$\",\"pre\",\"pre-2\",{\"className\":\"rounded-sm p-4 overflow-auto bg-zinc-900 text-zinc-100 my-4 border border-zinc-800\",\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-tf text-xs\",\"children\":\"$5\"}]}],\"\\n\",[\"$\",\"p\",\"p-31\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"the only configuration for the buckets is enabling the versioning and adding a lifecycle configuration to delete the files after 1 day.\"}],\"\\n\",[\"$\",\"p\",\"p-32\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":\"That way we're not going to spend so much money storing old assets and we could keep under the 5GiB that are in the S3 free tier.\"}],\"\\n\",[\"$\",\"h2\",\"h2-2\",{\"className\":\"text-xl font-bold mt-8 mb-4 text-zinc-100 border-b border-zinc-800 pb-2\",\"children\":\"Orchestrating: Step functions\"}],\"\\n\",[\"$\",\"p\",\"p-33\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"We require some way to indicate our lambda functions how they should \",[\"$\",\"em\",\"em-0\",{\"children\":\"flow\"}],\", this process is called \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"orchestration\"}],\" and I'm gonna use \",[\"$\",\"code\",\"code-1\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"step functions\"}],\" to accomplish this.\"]}],\"\\n\",[\"$\",\"p\",\"p-34\",{\"className\":\"text-sm text-zinc-300 my-4 leading-relaxed\",\"children\":[\"This is a \",[\"$\",\"code\",\"code-0\",{\"className\":\"bg-zinc-900 text-blue-600 px-1 py-0.5 rounded-sm text-xs\",\"children\":\"long long\"}],\" definition, so I'll trim it and keep the only part needed for the image, please also keep in mind this is just a \",[\"$\",\"em\",\"em-0\",{\"children\":\"draft\"}],\" and not the actual code. Also, you have to figure out by your own the required IAM permissions to make it work.\"]}],\"\\n\",[\"$\",\"pre\",\"pre-3\",{\"className\":\"rounded-sm p-4 overflow-auto bg-zinc-900 text-zinc-100 my-4 border border-zinc-800\",\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-tf text-xs\",\"children\":\"$6\"}]}]]}]}]]}]]}],\"$undefined\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/heneos-blog/_next/static/css/5eacd01f773eed7f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L7\",null,{\"children\":[\"$L8\",\"$L9\",null]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"2DTo-N-P1eUL2QvF7T1jE\",{\"children\":[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],null]}],[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$e\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"9:null\nd:[[\"$\",\"title\",\"0\",{\"children\":\"AWS Ascii Art | HeNeos blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Deploying an ascii art application in AWS\"}]]\n"])</script></body></html>